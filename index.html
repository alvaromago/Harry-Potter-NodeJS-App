<!DOCTYPE html>
<html lang="es">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Práctica Tema 4</title>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
			rel="stylesheet"
			integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
			crossorigin="anonymous"
		/>
	</head>
	<body class="container text-center">
		<h1 class="pt-5 pb-3">Práctica Tema 4</h1>
		<h3 style="color:darkcyan;">Personajes Harry Potter</h3>
		<div class="my-4">
			<button class="btn btn-primary" id="mostrarTodo">Mostrar todo</button>
			<button class="btn btn-primary" onclick="filtrar('filtro1')">Filtro 1</button>
			<button class="btn btn-primary" onclick="filtrar('filtro2')">Filtro 2</button>
			<button class="btn btn-primary" onclick="filtrar('filtro3')">Filtro 3</button>
			<button class="btn btn-primary" onclick="filtrar('filtro4')">Filtro 4</button>
		</div>
		<div>
			<table class="table">
				<thead>
					<tr>
						<th>Imagen</th>
						<th>Nombre</th>
						<th>Especie</th>
						<th>Género</th>
						<th>Casa</th>
						<th>Año de nacimiento</th>
						<th></th>
					</tr>
				</thead>
				<tbody id="tabla-personajes"></tbody>
			</table>
		</div>
		<div class="row pt-3">
			<div class="col-12 col-md-9 col-lg-6 mx-auto">
				<h2 class="text-center">Añadir personaje</h2>
				<form class="form" method="POST" id="form-personaje">
					<hr />
					<h4 style="color: red;">Campos obligatorios</h4>
					<div class="d-flex pt-2">
						<div class="mb-3 w-100 px-1">
							<label class="form-label">Nombre:</label>
							<input type="text" name="name" class="form-control" required />
						</div>
						<div class="mb-3 w-100 px-1">
							<label class="form-label">Especie:</label>
							<input type="text" name="species" class="form-control" required />
						</div>
						<div class="mb-3 w-100 px-1">
							<label class="form-label">Género:</label>
							<select name="gender" class="form-select" required>
								<option value="male">Hombre</option>
								<option value="female">Mujer</option>
							</select>
						</div>
					</div>
					<div class="d-flex">
						<div class="mb-3 w-100 px-1">
							<label class="form-label">Casa:</label>
							<select name="house" class="form-select" required>
								<option value="Gryffindor">Gryffindor</option>
								<option value="Slytherin">Slytherin</option>
								<option value="Ravenclaw">Ravenclaw</option>
								<option value="Hufflepuff">Hufflepuff</option>
							</select>
						</div>
						<div class="mb-3 w-100 px-1">
							<label class="form-label">Año de nacimiento:</label>
							<input type="number" class="form-control" name="yearOfBirth" required />
						</div>
					</div>
					<h4 style="color: orange;">Campos opcionales</h4>
					<div class="d-flex pt-2">
						<div class="mb-3 w-50 px-1">
							<label class="form-label">Fecha de nacimiento:</label>
							<input type="date" class="form-control" name="dateOfBirth" />
						</div>
						<div class="mb-3 w-50 px-1">
							<label class="form-label">Ancestros:</label>
							<input type="text" class="form-control" name="ancestry" />
						</div>
						<div class="mb-3 w-50 px-1">
							<label class="form-label">Color de ojos:</label>
							<input type="text" class="form-control" name="eyeColor" />
						</div>
						<div class="mb-3 w-50 px-1">
							<label class="form-label">Color de pelo:</label>
							<input type="text" class="form-control" name="hairColor" />
						</div>
					</div>
					<h6>Varita:</h6>
					<div class="d-flex">
						<div class="mb-3 w-100 px-1">
							<label class="form-label">Madera:</label>
							<input type="text" class="form-control" name="wood" />
						</div>
						<div class="mb-3 w-100 px-1">
							<label class="form-label">Núcleo:</label>
							<input type="text" class="form-control" name="core" />
						</div>
						<div class="mb-3 w-100 px-1">
							<label class="form-label">Longitud:</label>
							<input type="number" class="form-control" name="length" />
						</div>
					</div>
					<div class="d-flex">
						<div class="mb-3 w-50 px-1">
							<label class="form-label">Patronus:</label>
							<input type="text" class="form-control" name="patronus" />
						</div>
						<div class="mb-3 w-50 px-1">
							<label class="form-label">Estudiante:</label>
							<select name="hogwartsStudient" class="form-select" required>
								<option value="true">Si</option>
								<option value="false">No</option>
							</select>
						</div>
						<div class="mb-3 w-50 px-1">
							<label class="form-label">Trabajador:</label>
							<select name="hogwartsStaff" class="form-select" required>
								<option value="true">Si</option>
								<option value="false">No</option>
							</select>
						</div>
						<div class="mb-3 w-50 px-1">
							<label class="form-label">Actor:</label>
							<input type="text" class="form-control" name="actor" />
						</div>
						<div class="mb-3 w-50 px-1">
							<label class="form-label">¿Está vivo?:</label>
							<select name="alive" class="form-select" required>
								<option value="true">Si</option>
								<option value="false">No</option>
							</select>
						</div>
						<div class="mb-3 w-100 px-1">
							<label class="form-label">Imagen:</label>
							<input type="text" class="form-control" name="image" />
						</div>
					</div>
					<div id="agregar" class="btn btn-primary w-75 btn-lg">Guardar</div>
					<hr />
				</form>
			</div>
		</div>
		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
			integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
			crossorigin="anonymous"
		></script>
		<script>
			// Carga el documento para poder registrar los elementos
			document.addEventListener("DOMContentLoaded", function () {
			  let mostrarTodo = document.getElementById("mostrarTodo");
			  let filtro1 = document.getElementById("humano");
			  let btnGuardar = document.getElementById("agregar");

			  mostrarTodo.addEventListener("click", function (e) {
			    e.preventDefault();

			    let url = "http://localhost:8080/consultar";
			    let datos = "";

			    let httpRequest = new XMLHttpRequest();
			    httpRequest.open("POST", url, true);
			    httpRequest.setRequestHeader("Content-Type", "application/json");
			    httpRequest.send(JSON.stringify(datos));

			    httpRequest.onload = function (e) {
			      if (httpRequest.status === 200) {
			        document.getElementById("tabla-personajes").innerHTML =
			          httpRequest.responseText;
			      } else {
			        console.error("Error al cargar los datos");
			      }
			    };
			  });

			    // Registra el click en el botón GUARDAR para el nuevo personaje
			  document
			    .getElementById("agregar")
			    .addEventListener("click", function () {
			      // Obtener los datos del formulario
			      let formData = {
			        name: document.querySelector('input[name="name"]').value,
			        species: document.querySelector('input[name="species"]').value,
			        gender: document.querySelector('select[name="gender"]').value,
			        house: document.querySelector('select[name="house"]').value,
			        yearOfBirth: document.querySelector('input[name="yearOfBirth"]')
			          .value,
			        dateOfBirth: document.querySelector('input[name="dateOfBirth"]')
			          .value,
			        ancestry: document.querySelector('input[name="ancestry"]').value,
			        eyeColor: document.querySelector('input[name="eyeColor"]').value,
			        hairColor: document.querySelector('input[name="hairColor"]')
			          .value,
			        wood: document.querySelector('input[name="wood"]').value,
			        core: document.querySelector('input[name="core"]').value,
			        length: document.querySelector('input[name="length"]').value,
			        patronus: document.querySelector('input[name="patronus"]').value,
			        hogwartsStudient: document.querySelector(
			          'select[name="hogwartsStudient"]'
			        ).value,
			        hogwartsStaff: document.querySelector(
			          'select[name="hogwartsStaff"]'
			        ).value,
			        actor: document.querySelector('input[name="actor"]').value,
			        alive: document.querySelector('select[name="alive"]').value,
			        image: document.querySelector('input[name="image"]').value,
			      };

			      let httpRequest = new XMLHttpRequest();
			      httpRequest.open(
			        "POST",
			        "http://localhost:8080/agregarPersonaje",
			        true
			      );
			      httpRequest.setRequestHeader("Content-Type", "application/json");
			      httpRequest.send(JSON.stringify(formData));

			      httpRequest.onload = function () {
			        if (httpRequest.status === 200) {
			          alert("Personaje agregado correctamente.");
			          document.getElementById("form-personaje").reset();
			          location.reload();
			        } else {
			          alert("Error al agregar el personaje.");
			        }
			      };
			    });
			});

			function filtrar(filtro) {
			  let url = `http://localhost:8080/${filtro}`;
			  let datos = "";
			  let httpRequest = new XMLHttpRequest();
			  httpRequest.open("POST", url, true);
			  httpRequest.setRequestHeader("Content-Type", "application/json");
			  httpRequest.send(JSON.stringify(datos));

			  httpRequest.onload = function (e) {
			    if (httpRequest.status === 200) {
			      document.getElementById("tabla-personajes").innerHTML =
			        httpRequest.responseText;
			    } else {
			      console.error("Error al cargar los datos");
			    }
			  };
			}

			function eliminarRegistro(id) {
			  let confirmacion = confirm(
			    "¿Estás seguro de que quieres eliminar este personaje?"
			  );
			  if (confirmacion) {
			    let url = `http://localhost:8080/eliminar/${id}`;
			    let httpRequest = new XMLHttpRequest();
			    httpRequest.open("DELETE", url, true);
			    httpRequest.setRequestHeader("Content-Type", "application/json");
			    httpRequest.send();
			    httpRequest.onload = function () {
			      if (httpRequest.status === 200) {
			        // Eliminar la fila de la tabla
			        let fila = document.getElementById(`fila-${id}`);
			        if (fila) {
			          fila.parentNode.removeChild(fila);
			        }
			        alert("Personaje eliminado correctamente.");
			        setTimeout(function () {
			          window.location.reload();
			        }, 1000);
			      } else {
			        alert("Error al eliminar el personaje.");
			      }
			    };
			  }
			}
		</script>
	</body>
</html>
